!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}}(self,(function(){return(()=>{var e={547:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Store:()=>r,get:()=>o,set:()=>a,update:()=>c,del:()=>h,clear:()=>l,keys:()=>d,close:()=>u});class r{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbName=e,this._storeName=t,this._init()}_init(){this._dbp||(this._dbp=new Promise(((e,t)=>{const i=indexedDB.open(this._dbName);i.onerror=()=>t(i.error),i.onsuccess=()=>e(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(this._storeName)}})))}_withIDBStore(e,t){return this._init(),this._dbp.then((i=>new Promise(((r,n)=>{const s=i.transaction(this.storeName,e);s.oncomplete=()=>r(),s.onabort=s.onerror=()=>n(s.error),t(s.objectStore(this.storeName))}))))}_close(){return this._init(),this._dbp.then((e=>{e.close(),this._dbp=void 0}))}}let n;function s(){return n||(n=new r),n}function o(e,t=s()){let i;return t._withIDBStore("readwrite",(t=>{i=t.get(e)})).then((()=>i.result))}function a(e,t,i=s()){return i._withIDBStore("readwrite",(i=>{i.put(t,e)}))}function c(e,t,i=s()){return i._withIDBStore("readwrite",(i=>{const r=i.get(e);r.onsuccess=()=>{i.put(t(r.result),e)}}))}function h(e,t=s()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}function l(e=s()){return e._withIDBStore("readwrite",(e=>{e.clear()}))}function d(e=s()){const t=[];return e._withIDBStore("readwrite",(e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}})).then((()=>t))}function u(e=s()){return e._close()}},560:(e,t,i)=>{const r=i(497),{EEXIST:n,ENOENT:s,ENOTDIR:o,ENOTEMPTY:a}=i(728);e.exports=class{constructor(){}_makeRoot(e=new Map){return e.set(0,{mode:511,type:"dir",size:0,ino:0,mtimeMs:Date.now()}),e}activate(e=null){this._root=null===e?new Map([["/",this._makeRoot()]]):"string"==typeof e?new Map([["/",this._makeRoot(this.parse(e))]]):e}get activated(){return!!this._root}deactivate(){this._root=void 0}size(){return this._countInodes(this._root.get("/"))-1}_countInodes(e){let t=1;for(let[i,r]of e)0!==i&&(t+=this._countInodes(r));return t}autoinc(){return this._maxInode(this._root.get("/"))+1}_maxInode(e){let t=e.get(0).ino;for(let[i,r]of e)0!==i&&(t=Math.max(t,this._maxInode(r)));return t}print(e=this._root.get("/")){let t="";const i=(e,r)=>{for(let[n,s]of e){if(0===n)continue;let e=s.get(0),o=e.mode.toString(8);t+=`${"\t".repeat(r)}${n}\t${o}`,"file"===e.type?t+=`\t${e.size}\t${e.mtimeMs}\n`:(t+="\n",i(s,r+1))}};return i(e,0),t}parse(e){let t=0;function i(e){const i=++t,r=1===e.length?"dir":"file";let[n,s,o]=e;return n=parseInt(n,8),s=s?parseInt(s):0,o=o?parseInt(o):Date.now(),new Map([[0,{mode:n,type:r,size:s,mtimeMs:o,ino:i}]])}let r=e.trim().split("\n"),n=this._makeRoot(),s=[{indent:-1,node:n},{indent:0,node:null}];for(let e of r){let t=e.match(/^\t*/)[0].length;e=e.slice(t);let[r,...n]=e.split("\t"),o=i(n);if(t<=s[s.length-1].indent)for(;t<=s[s.length-1].indent;)s.pop();s.push({indent:t,node:o}),s[s.length-2].node.set(r,o)}return n}_lookup(e,t=!0){let i=this._root,n="/",o=r.split(e);for(let a=0;a<o.length;++a){let c=o[a];if(i=i.get(c),!i)throw new s(e);if(t||a<o.length-1){const e=i.get(0);if("symlink"===e.type){let t=r.resolve(n,e.target);i=this._lookup(t)}n=n?r.join(n,c):c}}return i}mkdir(e,{mode:t}){if("/"===e)throw new n;let i=this._lookup(r.dirname(e)),s=r.basename(e);if(i.has(s))throw new n;let o=new Map,a={mode:t,type:"dir",size:0,mtimeMs:Date.now(),ino:this.autoinc()};o.set(0,a),i.set(s,o)}rmdir(e){let t=this._lookup(e);if("dir"!==t.get(0).type)throw new o;if(t.size>1)throw new a;let i=this._lookup(r.dirname(e)),n=r.basename(e);i.delete(n)}readdir(e){let t=this._lookup(e);if("dir"!==t.get(0).type)throw new o;return[...t.keys()].filter((e=>"string"==typeof e))}writeStat(e,t,{mode:i}){let n;try{let t=this.stat(e);null==i&&(i=t.mode),n=t.ino}catch(e){}null==i&&(i=438),null==n&&(n=this.autoinc());let s=this._lookup(r.dirname(e)),o=r.basename(e),a={mode:i,type:"file",size:t,mtimeMs:Date.now(),ino:n},c=new Map;return c.set(0,a),s.set(o,c),a}unlink(e){let t=this._lookup(r.dirname(e)),i=r.basename(e);t.delete(i)}rename(e,t){let i=r.basename(t),n=this._lookup(e);this._lookup(r.dirname(t)).set(i,n),this.unlink(e)}stat(e){return this._lookup(e).get(0)}lstat(e){return this._lookup(e,!1).get(0)}readlink(e){return this._lookup(e,!1).get(0).target}symlink(e,t){let i,n;try{let e=this.stat(t);null===n&&(n=e.mode),i=e.ino}catch(e){}null==n&&(n=40960),null==i&&(i=this.autoinc());let s=this._lookup(r.dirname(t)),o=r.basename(t),a={mode:n,type:"symlink",target:e,size:0,mtimeMs:Date.now(),ino:i},c=new Map;return c.set(0,a),s.set(o,c),a}_du(e){let t=0;for(const[i,r]of e.entries())t+=0===i?r.size:this._du(r);return t}du(e){let t=this._lookup(e);return this._du(t)}}},788:(e,t,i)=>{const{encode:r,decode:n}=i(36),s=i(708),o=i(560),{ENOENT:a,ENOTEMPTY:c,ETIMEDOUT:h}=i(728),l=i(190),d=i(503),u=i(913),f=i(967),p=i(497);e.exports=class{constructor(){this.saveSuperblock=s((()=>{this._saveSuperblock()}),500)}async init(e,{wipe:t,url:i,urlauto:r,fileDbName:n=e,fileStoreName:s=e+"_files",lockDbName:a=e+"_lock",lockStoreName:c=e+"_lock"}={}){this._name=e,this._idb=new l(n,s),this._mutex=navigator.locks?new f(e):new u(a,c),this._cache=new o(e),this._opts={wipe:t,url:i},this._needsWipe=!!t,i&&(this._http=new d(i),this._urlauto=!!r)}async activate(){if(this._cache.activated)return;this._needsWipe&&(this._needsWipe=!1,await this._idb.wipe(),await this._mutex.release({force:!0})),await this._mutex.has()||await this._mutex.wait();const e=await this._idb.loadSuperblock();if(e)this._cache.activate(e);else if(this._http){const e=await this._http.loadSuperblock();this._cache.activate(e),await this._saveSuperblock()}else this._cache.activate();if(!await this._mutex.has())throw new h}async deactivate(){await this._mutex.has()&&await this._saveSuperblock(),this._cache.deactivate();try{await this._mutex.release()}catch(e){console.log(e)}await this._idb.close()}async _saveSuperblock(){this._cache.activated&&(this._lastSavedAt=Date.now(),await this._idb.saveSuperblock(this._cache._root))}_writeStat(e,t,i){let r=p.split(p.dirname(e)),n=r.shift();for(let e of r){n=p.join(n,e);try{this._cache.mkdir(n,{mode:511})}catch(e){}}return this._cache.writeStat(e,t,i)}async readFile(e,t){const{encoding:i}=t;if(i&&"utf8"!==i)throw new Error('Only "utf8" encoding is supported in readFile');let r=null,s=null;try{s=this._cache.stat(e),r=await this._idb.readFile(s.ino)}catch(e){if(!this._urlauto)throw e}if(!r&&this._http){let t=this._cache.lstat(e);for(;"symlink"===t.type;)e=p.resolve(p.dirname(e),t.target),t=this._cache.lstat(e);r=await this._http.readFile(e)}if(r&&(s&&s.size==r.byteLength||(s=await this._writeStat(e,r.byteLength,{mode:s?s.mode:438}),this.saveSuperblock()),"utf8"===i&&(r=n(r))),!s)throw new a(e);return r}async writeFile(e,t,i){const{mode:n,encoding:s="utf8"}=i;if("string"==typeof t){if("utf8"!==s)throw new Error('Only "utf8" encoding is supported in writeFile');t=r(t)}const o=await this._cache.writeStat(e,t.byteLength,{mode:n});await this._idb.writeFile(o.ino,t)}async unlink(e,t){const i=this._cache.lstat(e);this._cache.unlink(e),"symlink"!==i.type&&await this._idb.unlink(i.ino)}readdir(e,t){return this._cache.readdir(e)}mkdir(e,t){const{mode:i=511}=t;this._cache.mkdir(e,{mode:i})}rmdir(e,t){if("/"===e)throw new c;this._cache.rmdir(e)}rename(e,t){this._cache.rename(e,t)}stat(e,t){return this._cache.stat(e)}lstat(e,t){return this._cache.lstat(e)}readlink(e,t){return this._cache.readlink(e)}symlink(e,t){this._cache.symlink(e,t)}async backFile(e,t){let i=await this._http.sizeFile(e);await this._writeStat(e,i,t)}du(e){return this._cache.du(e)}}},503:e=>{e.exports=class{constructor(e){this._url=e}loadSuperblock(){return fetch(this._url+"/.superblock.txt").then((e=>e.ok?e.text():null))}async readFile(e){const t=await fetch(this._url+e);if(200===t.status)return t.arrayBuffer();throw new Error("ENOENT")}async sizeFile(e){const t=await fetch(this._url+e,{method:"HEAD"});if(200===t.status)return t.headers.get("content-length");throw new Error("ENOENT")}}},190:(e,t,i)=>{const r=i(547);e.exports=class{constructor(e,t){this._database=e,this._storename=t,this._store=new r.Store(this._database,this._storename)}saveSuperblock(e){return r.set("!root",e,this._store)}loadSuperblock(){return r.get("!root",this._store)}readFile(e){return r.get(e,this._store)}writeFile(e,t){return r.set(e,t,this._store)}unlink(e){return r.del(e,this._store)}wipe(){return r.clear(this._store)}close(){return r.close(this._store)}}},913:(e,t,i)=>{const r=i(547),n=e=>new Promise((t=>setTimeout(t,e)));e.exports=class{constructor(e,t){this._id=Math.random(),this._database=e,this._storename=t,this._store=new r.Store(this._database,this._storename),this._lock=null}async has({margin:e=2e3}={}){if(this._lock&&this._lock.holder===this._id){const t=Date.now();return this._lock.expires>t+e||await this.renew()}return!1}async renew({ttl:e=5e3}={}){let t;return await r.update("lock",(i=>{const r=Date.now()+e;return t=i&&i.holder===this._id,this._lock=t?{holder:this._id,expires:r}:i,this._lock}),this._store),t}async acquire({ttl:e=5e3}={}){let t,i,n;if(await r.update("lock",(r=>{const s=Date.now(),o=s+e;return i=r&&r.expires<s,t=void 0===r||i,n=r&&r.holder===this._id,this._lock=t?{holder:this._id,expires:o}:r,this._lock}),this._store),n)throw new Error("Mutex double-locked");return t}async wait({interval:e=100,limit:t=6e3,ttl:i}={}){for(;t--;){if(await this.acquire({ttl:i}))return!0;await n(e)}throw new Error("Mutex timeout")}async release({force:e=!1}={}){let t,i,n;if(await r.update("lock",(r=>(t=e||r&&r.holder===this._id,i=void 0===r,n=r&&r.holder!==this._id,this._lock=t?void 0:r,this._lock)),this._store),await r.close(this._store),!t&&!e){if(i)throw new Error("Mutex double-freed");if(n)throw new Error("Mutex lost ownership")}return t}}},967:e=>{e.exports=class{constructor(e){this._id=Math.random(),this._database=e,this._has=!1,this._release=null}async has(){return this._has}async acquire(){return new Promise((e=>{navigator.locks.request(this._database+"_lock",{ifAvailable:!0},(t=>(this._has=!!t,e(!!t),new Promise((e=>{this._release=e})))))}))}async wait({timeout:e=6e5}={}){return new Promise(((t,i)=>{const r=new AbortController;setTimeout((()=>{r.abort(),i(new Error("Mutex timeout"))}),e),navigator.locks.request(this._database+"_lock",{signal:r.signal},(e=>(this._has=!!e,t(!!e),new Promise((e=>{this._release=e})))))}))}async release({force:e=!1}={}){this._has=!1,this._release?this._release():e&&navigator.locks.request(this._database+"_lock",{steal:!0},(e=>!0))}}},582:(e,t,i)=>{const r=i(788),n=i(665),s=i(497);function o(e,t,...i){return void 0!==t&&"function"!=typeof t||(t={}),"string"==typeof t&&(t={encoding:t}),[e=s.normalize(e),t,...i]}function a(e,t,i,...r){return void 0!==i&&"function"!=typeof i||(i={}),"string"==typeof i&&(i={encoding:i}),[e=s.normalize(e),t,i,...r]}function c(e,t,...i){return[s.normalize(e),s.normalize(t),...i]}e.exports=class{constructor(e,t={}){this.init=this.init.bind(this),this.readFile=this._wrap(this.readFile,o,!1),this.writeFile=this._wrap(this.writeFile,a,!0),this.unlink=this._wrap(this.unlink,o,!0),this.readdir=this._wrap(this.readdir,o,!1),this.mkdir=this._wrap(this.mkdir,o,!0),this.rmdir=this._wrap(this.rmdir,o,!0),this.rename=this._wrap(this.rename,c,!0),this.stat=this._wrap(this.stat,o,!1),this.lstat=this._wrap(this.lstat,o,!1),this.readlink=this._wrap(this.readlink,o,!1),this.symlink=this._wrap(this.symlink,c,!0),this.backFile=this._wrap(this.backFile,o,!0),this.du=this._wrap(this.du,o,!1),this._deactivationPromise=null,this._deactivationTimeout=null,this._activationPromise=null,this._operations=new Set,e&&this.init(e,t)}async init(...e){return this._initPromiseResolve&&await this._initPromise,this._initPromise=this._init(...e),this._initPromise}async _init(e,t={}){await this._gracefulShutdown(),this._activationPromise&&await this._deactivate(),this._backend&&this._backend.destroy&&await this._backend.destroy(),this._backend=t.backend||new r,this._backend.init&&await this._backend.init(e,t),this._initPromiseResolve&&(this._initPromiseResolve(),this._initPromiseResolve=null),t.defer||this.stat("/")}async _gracefulShutdown(){this._operations.size>0&&(this._isShuttingDown=!0,await new Promise((e=>this._gracefulShutdownResolve=e)),this._isShuttingDown=!1,this._gracefulShutdownResolve=null)}_wrap(e,t,i){return async(...r)=>{r=t(...r);let n={name:e.name,args:r};this._operations.add(n);try{return await this._activate(),await e.apply(this,r)}finally{this._operations.delete(n),i&&this._backend.saveSuperblock(),0===this._operations.size&&(this._deactivationTimeout||clearTimeout(this._deactivationTimeout),this._deactivationTimeout=setTimeout(this._deactivate.bind(this),500))}}}async _activate(){this._initPromise||console.warn(new Error(`Attempted to use LightningFS ${this._name} before it was initialized.`)),await this._initPromise,this._deactivationTimeout&&(clearTimeout(this._deactivationTimeout),this._deactivationTimeout=null),this._deactivationPromise&&await this._deactivationPromise,this._deactivationPromise=null,this._activationPromise||(this._activationPromise=this._backend.activate?this._backend.activate():Promise.resolve()),await this._activationPromise}async _deactivate(){return this._activationPromise&&await this._activationPromise,this._deactivationPromise||(this._deactivationPromise=this._backend.deactivate?this._backend.deactivate():Promise.resolve()),this._activationPromise=null,this._gracefulShutdownResolve&&this._gracefulShutdownResolve(),this._deactivationPromise}async readFile(e,t){return this._backend.readFile(e,t)}async writeFile(e,t,i){return await this._backend.writeFile(e,t,i),null}async unlink(e,t){return await this._backend.unlink(e,t),null}async readdir(e,t){return this._backend.readdir(e,t)}async mkdir(e,t){return await this._backend.mkdir(e,t),null}async rmdir(e,t){return await this._backend.rmdir(e,t),null}async rename(e,t){return await this._backend.rename(e,t),null}async stat(e,t){const i=await this._backend.stat(e,t);return new n(i)}async lstat(e,t){const i=await this._backend.lstat(e,t);return new n(i)}async readlink(e,t){return this._backend.readlink(e,t)}async symlink(e,t){return await this._backend.symlink(e,t),null}async backFile(e,t){return await this._backend.backFile(e,t),null}async du(e){return this._backend.du(e)}}},665:e=>{e.exports=class{constructor(e){this.type=e.type,this.mode=e.mode,this.size=e.size,this.ino=e.ino,this.mtimeMs=e.mtimeMs,this.ctimeMs=e.ctimeMs||e.mtimeMs,this.uid=1,this.gid=1,this.dev=1}isFile(){return"file"===this.type}isDirectory(){return"dir"===this.type}isSymbolicLink(){return"symlink"===this.type}}},728:e=>{function t(e){return class extends Error{constructor(...t){super(...t),this.code=e,this.message?this.message=e+": "+this.message:this.message=e}}}const i=t("EEXIST"),r=t("ENOENT"),n=t("ENOTDIR"),s=t("ENOTEMPTY"),o=t("ETIMEDOUT");e.exports={EEXIST:i,ENOENT:r,ENOTDIR:n,ENOTEMPTY:s,ETIMEDOUT:o}},914:(e,t,i)=>{const r=i(97),n=i(582);function s(e,t){return"function"==typeof e&&(t=e),[(...e)=>t(null,...e),t=r(t)]}e.exports=class{constructor(...e){this.promises=new n(...e),this.init=this.init.bind(this),this.readFile=this.readFile.bind(this),this.writeFile=this.writeFile.bind(this),this.unlink=this.unlink.bind(this),this.readdir=this.readdir.bind(this),this.mkdir=this.mkdir.bind(this),this.rmdir=this.rmdir.bind(this),this.rename=this.rename.bind(this),this.stat=this.stat.bind(this),this.lstat=this.lstat.bind(this),this.readlink=this.readlink.bind(this),this.symlink=this.symlink.bind(this),this.backFile=this.backFile.bind(this),this.du=this.du.bind(this)}init(e,t){return this.promises.init(e,t)}readFile(e,t,i){const[r,n]=s(t,i);this.promises.readFile(e,t).then(r).catch(n)}writeFile(e,t,i,r){const[n,o]=s(i,r);this.promises.writeFile(e,t,i).then(n).catch(o)}unlink(e,t,i){const[r,n]=s(t,i);this.promises.unlink(e,t).then(r).catch(n)}readdir(e,t,i){const[r,n]=s(t,i);this.promises.readdir(e,t).then(r).catch(n)}mkdir(e,t,i){const[r,n]=s(t,i);this.promises.mkdir(e,t).then(r).catch(n)}rmdir(e,t,i){const[r,n]=s(t,i);this.promises.rmdir(e,t).then(r).catch(n)}rename(e,t,i){const[r,n]=s(i);this.promises.rename(e,t).then(r).catch(n)}stat(e,t,i){const[r,n]=s(t,i);this.promises.stat(e).then(r).catch(n)}lstat(e,t,i){const[r,n]=s(t,i);this.promises.lstat(e).then(r).catch(n)}readlink(e,t,i){const[r,n]=s(t,i);this.promises.readlink(e).then(r).catch(n)}symlink(e,t,i){const[r,n]=s(i);this.promises.symlink(e,t).then(r).catch(n)}backFile(e,t,i){const[r,n]=s(t,i);this.promises.backFile(e,t).then(r).catch(n)}du(e,t){const[i,r]=s(t);this.promises.du(e).then(i).catch(r)}}},497:e=>{function t(e){if(0===e.length)return".";let t=r(e);return t=t.reduce(n,[]),i(...t)}function i(...e){if(0===e.length)return"";let t=e.join("/");return t=t.replace(/\/{2,}/g,"/"),t}function r(e){if(0===e.length)return[];if("/"===e)return["/"];let t=e.split("/");return""===t[t.length-1]&&t.pop(),"/"===e[0]?t[0]="/":"."!==t[0]&&t.unshift("."),t}function n(e,t){if(0===e.length)return e.push(t),e;if("."===t)return e;if(".."===t){if(1===e.length){if("/"===e[0])throw new Error("Unable to normalize path - traverses above root directory");if("."===e[0])return e.push(t),e}return".."===e[e.length-1]?(e.push(".."),e):(e.pop(),e)}return e.push(t),e}e.exports={join:i,normalize:t,split:r,basename:function(e){if("/"===e)throw new Error(`Cannot get basename of "${e}"`);const t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)},dirname:function(e){const t=e.lastIndexOf("/");if(-1===t)throw new Error(`Cannot get dirname of "${e}"`);return 0===t?"/":e.slice(0,t)},resolve:function(...e){let r="";for(let n of e)r=n.startsWith("/")?n:t(i(r,n));return r}}},806:function(e,t,i){!function(e){function t(){}function i(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===n.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,i=Math.min(65536,e.length+1),r=new Uint16Array(i),n=[],s=0;;){var o=t<e.length;if(!o||s>=i-1){if(n.push(String.fromCharCode.apply(null,r.subarray(0,s))),!o)return n.join("");e=e.subarray(t),s=t=0}if(0==(128&(o=e[t++])))r[s++]=o;else if(192==(224&o)){var a=63&e[t++];r[s++]=(31&o)<<6|a}else if(224==(240&o)){a=63&e[t++];var c=63&e[t++];r[s++]=(31&o)<<12|a<<6|c}else 240==(248&o)&&(65535<(o=(7&o)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(o-=65536,r[s++]=o>>>10&1023|55296,o=56320|1023&o),r[s++]=o)}}if(e.TextEncoder&&e.TextDecoder)return!1;var n=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var i=e.length,r=0,n=Math.max(32,i+(i>>>1)+7),s=new Uint8Array(n>>>3<<3);t<i;){var o=e.charCodeAt(t++);if(55296<=o&&56319>=o){if(t<i){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,o=((1023&o)<<10)+(1023&a)+65536)}if(55296<=o&&56319>=o)continue}if(r+4>s.length&&(n+=8,n=(n*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(n)).set(s),s=a),0==(4294967168&o))s[r++]=o;else{if(0==(4294965248&o))s[r++]=o>>>6&31|192;else if(0==(4294901760&o))s[r++]=o>>>12&15|224,s[r++]=o>>>6&63|128;else{if(0!=(4292870144&o))continue;s[r++]=o>>>18&7|240,s[r++]=o>>>12&63|128,s[r++]=o>>>6&63|128}s[r++]=63&o|128}}return s.slice?s.slice(0,r):s.subarray(0,r)},Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(i.prototype,"fatal",{value:!1}),Object.defineProperty(i.prototype,"ignoreBOM",{value:!1});var s=r;"function"==typeof Buffer&&Buffer.from?s=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(s=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var i=new XMLHttpRequest;return i.open("GET",t,!1),i.send(),i.responseText}catch(t){return r(e)}finally{URL.revokeObjectURL(t)}}),i.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),s(e)},e.TextEncoder=t,e.TextDecoder=i}("undefined"!=typeof window?window:void 0!==i.g?i.g:this)},700:e=>{e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");for(var i,r=String(e),n="",s=!!t&&!!t.extended,o=!!t&&!!t.globstar,a=!1,c=t&&"string"==typeof t.flags?t.flags:"",h=0,l=r.length;h<l;h++)switch(i=r[h]){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":n+="\\"+i;break;case"?":if(s){n+=".";break}case"[":case"]":if(s){n+=i;break}case"{":if(s){a=!0,n+="(";break}case"}":if(s){a=!1,n+=")";break}case",":if(a){n+="|";break}n+="\\"+i;break;case"*":for(var d=r[h-1],u=1;"*"===r[h+1];)u++,h++;var f=r[h+1];o?!(u>1)||"/"!==d&&void 0!==d||"/"!==f&&void 0!==f?n+="([^/]*)":(n+="((?:[^/]*(?:/|$))*)",h++):n+=".*";break;default:n+=i}return c&&~c.indexOf("g")||(n="^"+n+"$"),new RegExp(n,c)}},36:(e,t,i)=>{i(806),e.exports={encode:e=>(new TextEncoder).encode(e),decode:e=>(new TextDecoder).decode(e)}},708:e=>{e.exports=function(e,t,i){var r;return function(){if(!t)return e.apply(this,arguments);var n=this,s=arguments,o=i&&!r;return clearTimeout(r),r=setTimeout((function(){if(r=null,!o)return e.apply(n,s)}),t),o?e.apply(this,arguments):void 0}}},97:e=>{e.exports=function(e){var t,i;if("function"!=typeof e)throw new Error("expected a function but got "+e);return function(){return t?i:(t=!0,i=e.apply(this,arguments))}}},470:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function i(e,t){for(var i,r="",n=0,s=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(47===i)break;i=47}if(47===i){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){-1===c?(r="",n=0):n=(r=r.slice(0,c)).length-1-r.lastIndexOf("/"),s=a,o=0;continue}}else if(2===r.length||1===r.length){r="",n=0,s=a,o=0;continue}t&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+="/"+e.slice(s+1,a):r=e.slice(s+1,a),n=a-s-1;s=a,o=0}else 46===i&&-1!==o?++o:o=-1}return r}var r={resolve:function(){for(var e,r="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var o;s>=0?o=arguments[s]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(r=o+"/"+r,n=47===o.charCodeAt(0))}return r=i(r,!n),n?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),n=47===e.charCodeAt(e.length-1);return 0!==(e=i(e,!r)).length||r||(e="."),e.length>0&&n&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,i=0;i<arguments.length;++i){var n=arguments[i];t(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":r.normalize(e)},relative:function(e,i){if(t(e),t(i),e===i)return"";if((e=r.resolve(e))===(i=r.resolve(i)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var s=e.length,o=s-n,a=1;a<i.length&&47===i.charCodeAt(a);++a);for(var c=i.length-a,h=o<c?o:c,l=-1,d=0;d<=h;++d){if(d===h){if(c>h){if(47===i.charCodeAt(a+d))return i.slice(a+d+1);if(0===d)return i.slice(a+d)}else o>h&&(47===e.charCodeAt(n+d)?l=d:0===d&&(l=0));break}var u=e.charCodeAt(n+d);if(u!==i.charCodeAt(a+d))break;47===u&&(l=d)}var f="";for(d=n+l+1;d<=s;++d)d!==s&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+i.slice(a+l):(a+=l,47===i.charCodeAt(a)&&++a,i.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var i=e.charCodeAt(0),r=47===i,n=-1,s=!0,o=e.length-1;o>=1;--o)if(47===(i=e.charCodeAt(o))){if(!s){n=o;break}}else s=!1;return-1===n?r?"/":".":r&&1===n?"//":e.slice(0,n)},basename:function(e,i){if(void 0!==i&&"string"!=typeof i)throw new TypeError('"ext" argument must be a string');t(e);var r,n=0,s=-1,o=!0;if(void 0!==i&&i.length>0&&i.length<=e.length){if(i.length===e.length&&i===e)return"";var a=i.length-1,c=-1;for(r=e.length-1;r>=0;--r){var h=e.charCodeAt(r);if(47===h){if(!o){n=r+1;break}}else-1===c&&(o=!1,c=r+1),a>=0&&(h===i.charCodeAt(a)?-1==--a&&(s=r):(a=-1,s=c))}return n===s?s=c:-1===s&&(s=e.length),e.slice(n,s)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!o){n=r+1;break}}else-1===s&&(o=!1,s=r+1);return-1===s?"":e.slice(n,s)},extname:function(e){t(e);for(var i=-1,r=0,n=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===n&&(s=!1,n=a+1),46===c?-1===i?i=a:1!==o&&(o=1):-1!==i&&(o=-1);else if(!s){r=a+1;break}}return-1===i||-1===n||0===o||1===o&&i===n-1&&i===r+1?"":e.slice(i,n)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var i=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return i?i===t.root?i+r:i+"/"+r:r}(0,e)},parse:function(e){t(e);var i={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return i;var r,n=e.charCodeAt(0),s=47===n;s?(i.root="/",r=1):r=0;for(var o=-1,a=0,c=-1,h=!0,l=e.length-1,d=0;l>=r;--l)if(47!==(n=e.charCodeAt(l)))-1===c&&(h=!1,c=l+1),46===n?-1===o?o=l:1!==d&&(d=1):-1!==o&&(d=-1);else if(!h){a=l+1;break}return-1===o||-1===c||0===d||1===d&&o===c-1&&o===a+1?-1!==c&&(i.base=i.name=0===a&&s?e.slice(1,c):e.slice(a,c)):(0===a&&s?(i.name=e.slice(1,o),i.base=e.slice(1,c)):(i.name=e.slice(a,o),i.base=e.slice(a,c)),i.ext=e.slice(o,c)),a>0?i.dir=e.slice(0,a-1):s&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},112:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const n=i(470),s=i(549),o=i(215),a=i(587);t.activate=function(e){return r(this,void 0,void 0,(function*(){const t=new a.NativeFS;e.subscriptions.push(s.workspace.registerFileSystemProvider(a.NativeFS.scheme,t,{isCaseSensitive:!0,isReadonly:!1})),e.subscriptions.push(s.workspace.registerFileSearchProvider(a.NativeFS.scheme,t));const i=new o.MemFS;e.subscriptions.push(s.workspace.registerFileSystemProvider(o.MemFS.scheme,i,{isCaseSensitive:!0,isReadonly:!1})),e.subscriptions.push(s.workspace.registerFileSearchProvider(o.MemFS.scheme,i));const c=new TextEncoder,h=s.Uri.parse(`${o.MemFS.scheme}:/Welcome/`),l=s.Uri.parse(`${o.MemFS.scheme}:/Welcome/README.md`),d=s.Uri.parse(`${o.MemFS.scheme}:/web-fs.code-workspace`);try{yield i.createDirectory(h)}catch(e){}(yield i.exists(l))||(yield i.writeFile(l,c.encode("# Welcome! (Experiment)\nPlease open **Command Palette** then run: \n\n* `NativeFS: Open Folder` command to open a local folder on your device.  \n* `MemFS: Open Folder` command to create/open a temporary folder in memory. \n\nEnjoy!"),{create:!0,overwrite:!0})),(yield i.exists(d))||(yield i.writeFile(d,c.encode(`{\n        "folders": ${JSON.stringify([h])}\n      }`),{create:!0,overwrite:!0})),e.subscriptions.push(s.commands.registerCommand("nativefs.openFolder",(()=>r(this,void 0,void 0,(function*(){try{const e=yield s.commands.executeCommand("nativeFS.showDirectoryPicker");if(!e)return s.window.showErrorMessage("Failed to open folder");s.workspace.updateWorkspaceFolders(s.workspace.workspaceFolders?s.workspace.workspaceFolders.length:0,null,{uri:s.Uri.parse(`nativefs:${e}`),name:n.basename(e)})}catch(e){console.error(e),s.window.showErrorMessage("Your environment doesn't support the Native File System API")}}))))),e.subscriptions.push(s.commands.registerCommand("memfs.openFolder",(e=>r(this,void 0,void 0,(function*(){const e=yield s.window.showInputBox({value:"Welcome",placeHolder:"Please enter the folder name"});e||s.window.showErrorMessage("Empty folder name is not supported");try{yield i.createDirectory(s.Uri.parse(`${o.MemFS.scheme}:/${e}`))}catch(e){}s.workspace.updateWorkspaceFolders(0,0,{uri:s.Uri.parse(`${o.MemFS.scheme}:/${e}`),name:e})})))))}))},t.deactivate=function(){}},215:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MemFS=void 0;const n=i(700),s=i(470),o=i(549),a=i(882),c=i(914);class h{constructor(){this._emitter=new o.EventEmitter,this._bufferedEvents=[],this.onDidChangeFile=this._emitter.event;const e=new c("fs");this.pfs=e.promises}stat(e){return r(this,void 0,void 0,(function*(){try{const t=yield this.pfs.stat(e.path);return{type:t.isDirectory()?o.FileType.Directory:t.isFile()?o.FileType.File:t.isSymbolicLink()?o.FileType.SymbolicLink:o.FileType.Unknown,size:t.size,mtime:t.mtimeMs,ctime:t.ctimeMs}}catch(t){throw o.FileSystemError.FileNotFound(e)}}))}readDirectory(e){return r(this,void 0,void 0,(function*(){const t=yield this.pfs.readdir(e.path),i=[];for(let r=0;r<t.length;r++){const n=t[r],a=yield this.stat(o.Uri.parse(`memfs:${s.join(e.path,n)}`));i.push([n,a.type])}return i}))}readFile(e){return r(this,void 0,void 0,(function*(){try{return yield this.pfs.readFile(e.path)}catch(t){throw o.FileSystemError.FileNotFound(e)}}))}writeFile(e,t,i){return r(this,void 0,void 0,(function*(){const r=e.with({path:s.posix.dirname(e.path)});try{let n;try{n=yield this.stat(e)}catch(e){n=void 0}if(n&&n.type===o.FileType.Directory)throw o.FileSystemError.FileIsADirectory(e);if(!n&&!i.create)throw o.FileSystemError.FileNotFound(e);if(n&&i.create&&!i.overwrite)throw o.FileSystemError.FileExists(e);yield this.pfs.writeFile(e.path,t),n||(this._fireSoon({type:o.FileChangeType.Changed,uri:r}),this._fireSoon({type:o.FileChangeType.Created,uri:e})),this._fireSoon({type:o.FileChangeType.Changed,uri:e})}catch(e){throw e}}))}rename(e,t,i){return r(this,void 0,void 0,(function*(){let r;try{r=yield this.stat(t)}catch(e){r=void 0}if(!i.overwrite&&r)throw o.FileSystemError.FileExists(t);r&&r.type===o.FileType.Directory?yield this.mkdirp(t):yield this.mkdirp(o.Uri.parse(`memfs:${s.posix.dirname(t.path)}`));const n=yield this.readFile(e);yield this.writeFile(t,n,{create:!0,overwrite:i.overwrite}),yield this.delete(e)}))}exists(e){return r(this,void 0,void 0,(function*(){try{return!!(yield this.pfs.stat(e.path))}catch(e){return!1}}))}mkdirp(e){return r(this,void 0,void 0,(function*(){(yield this.exists(e))||(yield this.mkdirp(o.Uri.parse(`memfs:${s.posix.dirname(e.path)}`)),yield this.mkdir(e),this._fireSoon({type:o.FileChangeType.Changed,uri:o.Uri.parse(`memfs:${s.posix.dirname(e.path)}`)},{type:o.FileChangeType.Created,uri:o.Uri.parse(`memfs:${e}`)}))}))}mkdir(e){return r(this,void 0,void 0,(function*(){yield this.pfs.mkdir(e.path,"0777")}))}delete(e){return r(this,void 0,void 0,(function*(){let t;try{t=yield this.stat(e)}catch(e){t=void 0}if(!t)throw o.FileSystemError.FileNotFound(e);t.type===o.FileType.Directory?yield this.rmdir(e.path):yield this.unlink(e.path)}))}unlink(e){return r(this,void 0,void 0,(function*(){yield this.pfs.unlink(e),this._fireSoon({type:o.FileChangeType.Changed,uri:o.Uri.parse(`memfs:${s.posix.dirname(e)}`)},{uri:o.Uri.parse(`memfs:${e}`),type:o.FileChangeType.Deleted})}))}rmdir(e){return r(this,void 0,void 0,(function*(){const t=yield this.pfs.readdir(e),i=[];for(let r=0;r<t.length;r++){const n=t[r],o=s.resolve(e,n);(yield this.pfs.stat(o)).isDirectory()?i.push(this.rmdir(o)):i.push(this.unlink(o))}yield Promise.all(i),yield this.pfs.rmdir(e),this._fireSoon({type:o.FileChangeType.Changed,uri:o.Uri.parse(`memfs:${s.posix.dirname(e)}`)},{uri:o.Uri.parse(`memfs:${e}`),type:o.FileChangeType.Deleted})}))}createDirectory(e){return r(this,void 0,void 0,(function*(){try{yield this.mkdirp(e)}catch(e){throw e}}))}watch(e){return new o.Disposable((()=>{}))}_fireSoon(...e){this._bufferedEvents.push(...e),this._fireSoonHandle&&clearTimeout(this._fireSoonHandle),this._fireSoonHandle=setTimeout((()=>{this._emitter.fire(this._bufferedEvents),this._bufferedEvents.length=0}),5)}provideFileSearchResults(e,t,i){return r(this,void 0,void 0,(function*(){const i=yield this._getAllFiles(t.folder,t.excludes.map((e=>n(e)))),r=[],s=e.pattern?new RegExp(a.convertSimple2RegExpPattern(e.pattern),"i"):null;for(const e of i)s&&!s.exec(e.path)||r.push(e);return r}))}_getAllFiles(e=o.Uri.parse(`${h.scheme}:/`),t){return r(this,void 0,void 0,(function*(){let i=[];const r=yield this.readDirectory(e),n=[];for(let a=0;a<r.length;a++){const[c,l]=r[a],d=s.join(e.path,c);t.some((e=>e.exec(d)))||(l===o.FileType.File?i.push(o.Uri.parse(`${h.scheme}:${d}`)):l===o.FileType.Directory&&n.push(this._getAllFiles(o.Uri.parse(`${h.scheme}:${d}`),t)))}if(n.length){const e=yield Promise.all(n);i=i.concat(e.reduce(((e,t)=>e.concat(t)),[]))}return i}))}}t.MemFS=h,h.scheme="memfs"},587:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.NativeFS=void 0;const n=i(700),s=i(470),o=i(549),a=i(882);class c{constructor(){this._emitter=new o.EventEmitter,this._bufferedEvents=[],this.onDidChangeFile=this._emitter.event}stat(e){return r(this,void 0,void 0,(function*(){try{const t=yield o.commands.executeCommand("nativeFS.stat",e);if(t)return t;throw o.FileSystemError.FileNotFound(e)}catch(t){throw o.FileSystemError.FileNotFound(e)}}))}readDirectory(e){return r(this,void 0,void 0,(function*(){try{const t=yield o.commands.executeCommand("nativeFS.readDirectory",e);if(t)return t;throw o.FileSystemError.FileNotFound(e)}catch(t){throw o.FileSystemError.FileNotFound(e)}}))}readRootDirectories(){return r(this,void 0,void 0,(function*(){try{const e=yield o.commands.executeCommand("nativeFS.readRootDirectories");if(e)return e;throw o.FileSystemError.Unavailable}catch(e){throw o.FileSystemError.Unavailable}}))}readFile(e){return r(this,void 0,void 0,(function*(){try{const t=yield o.commands.executeCommand("nativeFS.readFile",e);if(t)return Uint8Array.from(t);throw o.FileSystemError.FileNotFound(e)}catch(t){throw o.FileSystemError.FileNotFound(e)}}))}writeFile(e,t,i){return r(this,void 0,void 0,(function*(){const{events:r}=(yield o.commands.executeCommand("nativeFS.writeFile",e,Array.from(t),i))||{events:[]};r&&(r||[]).forEach((e=>{this._fireSoon(e)}))}))}rename(e,t,i){return r(this,void 0,void 0,(function*(){const{events:r}=(yield o.commands.executeCommand("nativeFS.rename",e,t,i))||{events:[]};r&&(r||[]).forEach((e=>{this._fireSoon(e)}))}))}delete(e,t){return r(this,void 0,void 0,(function*(){const{events:i}=(yield o.commands.executeCommand("nativeFS.delete",e,t))||{events:[]};i&&(i||[]).forEach((e=>{this._fireSoon(e)}))}))}createDirectory(e){return r(this,void 0,void 0,(function*(){const{events:t}=(yield o.commands.executeCommand("nativeFS.createDirectory",e))||{events:[]};t&&(t||[]).forEach((e=>{this._fireSoon(e)}))}))}watch(e){return new o.Disposable((()=>{}))}_fireSoon(...e){this._bufferedEvents.push(...e),this._fireSoonHandle&&clearTimeout(this._fireSoonHandle),this._fireSoonHandle=setTimeout((()=>{this._emitter.fire(this._bufferedEvents),this._bufferedEvents.length=0}),5)}provideFileSearchResults(e,t,i){return r(this,void 0,void 0,(function*(){const i=yield this._getAllFiles(t.folder,t.excludes.map((e=>n(e)))),r=[],s=e.pattern?new RegExp(a.convertSimple2RegExpPattern(e.pattern),"i"):null;for(const e of i)s&&!s.exec(e.path)||r.push(e);return r}))}_getAllFiles(e=o.Uri.parse(`${c.scheme}:/`),t){return r(this,void 0,void 0,(function*(){let i=[],r=[];"/"===e.path?(yield this.readRootDirectories()).forEach((e=>{r.push([e,o.FileType.Directory])})):r=yield this.readDirectory(e);const n=[];for(let a=0;a<r.length;a++){const[c,h]=r[a],l=s.join(e.path,c);t.some((e=>e.exec(l)))||(h===o.FileType.File?i.push(o.Uri.parse(l)):h===o.FileType.Directory&&n.push(this._getAllFiles(o.Uri.parse(l),t)))}if(n.length){const e=yield Promise.all(n);i=i.concat(e.reduce(((e,t)=>e.concat(t)),[]))}return i}))}}t.NativeFS=c,c.scheme="nativefs"},882:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertSimple2RegExpPattern=void 0,t.convertSimple2RegExpPattern=function(e){return(e.split("").map((e=>e)).join(".*").replace(/\.\*\*+/g,".*")+".*").replace(/([\+\-\$\^\[\]\(\)])\.\*/g,"\\$1.*")}},549:e=>{"use strict";e.exports=require("vscode")}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}return i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(112)})()}));